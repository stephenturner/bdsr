<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Stephen D. Turner, Ph.D.">
<title>Biological Data Science with R - 7&nbsp; Reproducible Reporting with RMarkdown</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./stats.html" rel="next">
<link href="./tidyeda.html" rel="prev">
<link href="./hex.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./basics.html">Core Curriculum</a></li><li class="breadcrumb-item"><a href="./rmarkdown.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reproducible Reporting with RMarkdown</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Biological Data Science with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/stephenturner/bdsr" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Biological-Data-Science-with-R.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Biological-Data-Science-with-R.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Core Curriculum</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tibbles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Tibbles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Manipulation with dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tidy Data and Advanced Data Manipulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyeda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Refresher: Tidy Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reproducible Reporting with RMarkdown</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Electives</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Essential statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./predmodeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Predictive Analytics: Predicting and Forecasting Influenza</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./textmining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Text Mining and NLP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rnaseq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Count-Based Differential Expression Analysis of RNA-seq Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggtree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Visualizing and Annotating Phylogenetic Trees</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Further Resources</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#who-cares-about-reproducible-research" id="toc-who-cares-about-reproducible-research" class="nav-link active" data-scroll-target="#who-cares-about-reproducible-research"><span class="header-section-number">7.1</span> Who cares about reproducible research?</a>
  <ul class="collapse">
<li><a href="#reproducibility-is-hard" id="toc-reproducibility-is-hard" class="nav-link" data-scroll-target="#reproducibility-is-hard"><span class="header-section-number">7.1.1</span> Reproducibility is hard!</a></li>
  <li><a href="#whats-in-it-for-you" id="toc-whats-in-it-for-you" class="nav-link" data-scroll-target="#whats-in-it-for-you"><span class="header-section-number">7.1.2</span> What’s in it for <em>you?</em></a></li>
  <li><a href="#some-recommendations-for-reproducible-research" id="toc-some-recommendations-for-reproducible-research" class="nav-link" data-scroll-target="#some-recommendations-for-reproducible-research"><span class="header-section-number">7.1.3</span> Some recommendations for reproducible research</a></li>
  </ul>
</li>
  <li>
<a href="#rmarkdown" id="toc-rmarkdown" class="nav-link" data-scroll-target="#rmarkdown"><span class="header-section-number">7.2</span> RMarkdown</a>
  <ul class="collapse">
<li><a href="#markdown" id="toc-markdown" class="nav-link" data-scroll-target="#markdown"><span class="header-section-number">7.2.1</span> Markdown</a></li>
  <li><a href="#rmarkdown-workflow" id="toc-rmarkdown-workflow" class="nav-link" data-scroll-target="#rmarkdown-workflow"><span class="header-section-number">7.2.2</span> RMarkdown workflow</a></li>
  </ul>
</li>
  <li>
<a href="#authoring-rmarkdown-documents" id="toc-authoring-rmarkdown-documents" class="nav-link" data-scroll-target="#authoring-rmarkdown-documents"><span class="header-section-number">7.3</span> Authoring RMarkdown documents</a>
  <ul class="collapse">
<li><a href="#from-scratch" id="toc-from-scratch" class="nav-link" data-scroll-target="#from-scratch"><span class="header-section-number">7.3.1</span> From scratch</a></li>
  <li><a href="#from-a-template-with-yaml-metadata" id="toc-from-a-template-with-yaml-metadata" class="nav-link" data-scroll-target="#from-a-template-with-yaml-metadata"><span class="header-section-number">7.3.2</span> From a template with YAML metadata</a></li>
  <li><a href="#chunk-options" id="toc-chunk-options" class="nav-link" data-scroll-target="#chunk-options"><span class="header-section-number">7.3.3</span> Chunk options</a></li>
  <li><a href="#tables" id="toc-tables" class="nav-link" data-scroll-target="#tables"><span class="header-section-number">7.3.4</span> Tables</a></li>
  <li><a href="#changing-output-formats" id="toc-changing-output-formats" class="nav-link" data-scroll-target="#changing-output-formats"><span class="header-section-number">7.3.5</span> Changing output formats</a></li>
  </ul>
</li>
  <li><a href="#distributing-analyses-rpubs" id="toc-distributing-analyses-rpubs" class="nav-link" data-scroll-target="#distributing-analyses-rpubs"><span class="header-section-number">7.4</span> Distributing Analyses: Rpubs</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-rmarkdown" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reproducible Reporting with RMarkdown</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Contemporary life science is plagued by reproducibility issues. This workshop covers some of the barriers to reproducible research and how to start to address some of those problems during the data management and analysis phases of the research life cycle. In this workshop we will cover using R and dynamic document generation with RMarkdown and RStudio to weave together reporting text with executable R code to automatically generate reports in the form of PDF, Word, or HTML documents.</p>
<p>Spend a few minutes to learn a little bit about <em>Markdown</em>. All you really need to know is that Markdown is a lightweight markup language that lets you create styled text (like <strong>bold</strong>, <em>italics</em>, <a href="https://blog.stephenturner.us/">links</a>, etc.) using a very lightweight plain-text syntax: <code>(like **bold**, _italics_, [links](https://blog.stephenturner.us/), etc.)</code>. The resulting text file can be <em>rendered</em> into many downstream formats, like PDF (for printing) or HTML (websites).</p>
<ol type="1">
<li>
<em>(30 seconds)</em> Read the summary paragraph on the <a href="https://en.wikipedia.org/wiki/Markdown">Wikipedia page</a>.</li>
<li>
<em>(1 minute)</em> Bookmark and refer to this markdown reference: <a href="http://commonmark.org/help/" class="uri">http://commonmark.org/help/</a>.</li>
<li>
<em>(5-10 minutes)</em> Run through this 10-minute in-browser markdown tutorial: <a href="http://commonmark.org/help/tutorial/" class="uri">http://commonmark.org/help/tutorial/</a>.</li>
<li>
<em>(5-10 minutes)</em> Go to <a href="http://dillinger.io/" class="uri">http://dillinger.io/</a>, an in-browser Markdown editor, and play around. Write a simple markdown document, and export it to HTML and/or PDF.</li>
<li>
<em>(10 minutes)</em> See RStudio’s excellent documentation on Rmarkdown at <a href="http://rmarkdown.rstudio.com/" class="uri">http://rmarkdown.rstudio.com/</a>. Click “Getting Started” and watch the 1 minute video on the <a href="http://rmarkdown.rstudio.com/lesson-1.html">Introduction page</a>. Continue reading through each section here on the navigation bar to the left (<em>Introduction</em> through <em>Cheatsheets</em>, and optionally download and print out the cheat sheet). Finally, browse through the <a href="http://rmarkdown.rstudio.com/gallery.html">RMarkdown Gallery</a>.</li>
</ol>
<section id="who-cares-about-reproducible-research" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="who-cares-about-reproducible-research">
<span class="header-section-number">7.1</span> Who cares about reproducible research?</h2>
<p>Science is plagued by reproducibility problems. Especially genomics!</p>
<ul>
<li>Scientists in the United States spend <a href="http://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.1002165">$28 billion</a> each year on basic biomedical research that cannot be repeated successfully.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</li>
<li>A reproducibility study in psychology found that only <a href="http://www.nature.com/news/first-results-from-psychology-s-largest-reproducibility-test-1.17433">39 of 100 studies could be reproduced</a>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
</li>
<li>The Journal <em>Nature</em> on the <a href="http://www.nature.com/news/reproducibility-1.17552">issue of reproducibility</a>:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
<ul>
<li>“<em>Nature</em> and the Nature research journals will introduce editorial measures to address the problem by improving the consistency and quality of reporting in life-sciences articles… <strong>we will give more space to methods sections. We will examine statistics more closely and encourage authors to be transparent, for example by including their raw data.</strong>”<br>
</li>
<li>
<em>Nature</em> also released a <a href="http://www.nature.com/authors/policies/checklist.pdf">checklist</a>, unfortunately with <em>wimpy</em> computational check <em>(see #18)</em>.</li>
</ul>
</li>
<li>On microarray reproducibility:<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>
<ul>
<li>18 Nat. Genet. microarray experiments</li>
<li>Less than 50% reproducible</li>
<li>Problems:
<ul>
<li>Missing data (38%)</li>
<li>Missing software/hardware details (50%)</li>
<li>Missing method/processing details (66%)</li>
</ul>
</li>
</ul>
</li>
<li>NGS: run-of-the-mill variant calling (align, process, call variants):<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>
<ul>
<li>299 articles published in 2011 citing the 1000 Genomes project pilot publication</li>
<li>Only 19 were NGS studies with similar design</li>
<li>Only 10 used tools recommended by 1000G.</li>
<li>Only 4 used full 1000G workflow (realignment &amp; quality score recalibration).</li>
</ul>
</li>
</ul>
<p>Consider this figure:</p>
<p><img src="img/gm-lifeexp-vs-gdp.png" class="img-fluid"></p>
<p>How do we reproduce it? What do we need?</p>
<ul>
<li>The data.
<ul>
<li>Data points themselves.</li>
<li>Other metadata.</li>
</ul>
</li>
<li>The code.
<ul>
<li>Should be readable.</li>
<li>Comments in the code / well-documented so a normal person can figure out how it runs.</li>
<li>How were the trend lines drawn?</li>
<li>What version of software / packages were used?</li>
</ul>
</li>
</ul>
<p>This kind of information is rarely available in scientific publications, but it’s now extraordinarly easy to put this kind of information on the web.</p>
<p>Could I replicate Figure 1 from your last publication? If not, what would <em>you and your co-authors</em> need to provide or do so I could replicate Figure 1 from your last publication?</p>
<p><strong>As scientists we should aim for <em>robust</em> and <em>reproducible</em> research</strong></p>
<ul>
<li>“<strong>Robust research</strong> is about doing small things that stack the deck in your favor to prevent mistakes.”<br><em>—Vince Buffalo, author of Bioinformatics Data Skills (2015)</em>.</li>
<li>
<strong>Reproducible research</strong> can be repeated by other researchers with the same results.</li>
</ul>
<section id="reproducibility-is-hard" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="reproducibility-is-hard">
<span class="header-section-number">7.1.1</span> Reproducibility is hard!</h3>
<ol type="1">
<li>Genomics data is too large and high dimensional to easily inspect or visualize. Workflows involve multiple steps and it’s hard to inspect every step.</li>
<li>Unlike in the wet lab, we don’t always know what to expect of our genomics data analysis.</li>
<li>It can be hard to distinguish <em>good</em> from <em>bad</em> results.</li>
<li>Scientific code is usually only run once to generate results for a publication, and is more likely to contain silent bugs. (code that may produces unknowingly incorrect output rather than stopping with an error message).</li>
</ol></section><section id="whats-in-it-for-you" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="whats-in-it-for-you">
<span class="header-section-number">7.1.2</span> What’s in it for <em>you?</em>
</h3>
<p>Yeah, it takes a lot of effort to be robust and reproducible. However, <em>it will make your life (and science) easier!</em></p>
<ul>
<li>Most likely, you will have to re-run your analysis more than once.<br>
</li>
<li>In the future, you or a collaborator may have to re-visit part of the project.</li>
<li>Your most likely collaborator is your future self, and your past self doesn’t answer emails.</li>
<li>You can make modularized parts of the project into re-useable tools for the future.<br>
</li>
<li>Reproducibility makes you easier to work and collaborate with.</li>
</ul></section><section id="some-recommendations-for-reproducible-research" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="some-recommendations-for-reproducible-research">
<span class="header-section-number">7.1.3</span> Some recommendations for reproducible research</h3>
<ol type="1">
<li>
<strong>Write code for humans, write data for computers.</strong>
<ul>
<li>Code should be broken down into small chunks that may be re-used.<br>
</li>
<li>Make names/variables consistent, distinctive and meaningful.<br>
</li>
<li>Adopt a <a href="http://adv-r.had.co.nz/Style.html">style</a> be consistent.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>
</li>
<li>Write concise and clear comments.</li>
</ul>
</li>
<li>
<strong>Make incremental changes.</strong> Work in small steps with frequent feedback. Use version control. See <a href="http://swcarpentry.github.io/git-novice/" class="uri">http://swcarpentry.github.io/git-novice/</a> for resources on version control.</li>
<li>
<strong>Make assertions and be loud, in code and in your methods.</strong> Add tests in your code to make sure it’s doing what you expect. See <a href="http://software-carpentry.org/v4/test/" class="uri">http://software-carpentry.org/v4/test/</a> for resources on testing code.</li>
<li>
<strong>Use existing libraries (packages) whenever possible.</strong> Don’t reinvent the wheel. Use functions that have already been developed and tested by others.</li>
<li>
<strong>Prevent catastrophe and help reproducibility by making your data <em>read-only</em>.</strong> Rather than modifying your original data directly, always use a workflow that reads in data, processes/modifies, then writes out intermediate and final files as necessary.</li>
<li>
<strong>Encapsulate the full project into one directory that is supported with version control.</strong> See: Noble, William Stafford. “A quick guide to organizing computational biology projects.” <a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424"><em>PLoS Comput Biol</em> 5.7 (2009): e1000424</a>.</li>
<li>
<strong>Release your code and data.</strong> Simple. Without your code and data, your research is not reproducible.
<ul>
<li>GitHub (<a href="https://github.com/" class="uri">https://github.com/</a>) is a great place for storing, distributing, collaborating, and version-controlling code.</li>
<li>RPubs (<a href="http://rpubs.com/" class="uri">http://rpubs.com/</a>) allows you to share dynamic documents you write in RStudio online.</li>
<li>Figshare (<a href="http://figshare.com/" class="uri">http://figshare.com/</a>) and Zenodo (<a href="https://zenodo.org/" class="uri">https://zenodo.org/</a>) allow you to upload any kind of research output, publishable or not, free and unlimited. Instantly get permanently available, citable DOI for your research output.</li>
<li>
<em>“Data/code is available upon request”</em> or <em>“Data/code is available at the lab’s website”</em> are completely unacceptable in the 21st century.</li>
</ul>
</li>
<li>
<strong>Write code that uses relative paths.</strong>
<ul>
<li>Don’t use hard-coded absolute paths (i.e.&nbsp;<code>/Users/stephen/Data/seq-data.csv</code> or <code>C:\Stephen\Documents\Data\Project1\data.txt</code>).</li>
<li>Put the data in the project directory and reference it <em>relative</em> to where the code is, e.g., <code>data/gapminder.csv</code>, etc.<br>
</li>
</ul>
</li>
<li>
<strong>Always set your seed.</strong> If you’re doing anything that involves random/monte-carlo approaches, always use <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code>.</li>
<li>
<strong>Document everything and use code as documentation.</strong>
<ul>
<li>Document why you do something, not mechanics.</li>
<li>Document your methods and workflows.</li>
<li>Document the origin of all data in your project directory.</li>
<li>Document <strong>when</strong> and <strong>how</strong> you downloaded the data.</li>
<li>Record <strong>data</strong> version info.</li>
<li>Record <strong>software</strong> version info with <code>session_info()</code>.</li>
<li>Use dynamic documentation to make your life easier.</li>
</ul>
</li>
</ol></section></section><section id="rmarkdown" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="rmarkdown">
<span class="header-section-number">7.2</span> RMarkdown</h2>
<p>RMarkdown is a variant of Markdown that lets you embed R code chunks that execute when you compile the document. What, what? Markdown? Compile? What’s all this about?</p>
<section id="markdown" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="markdown">
<span class="header-section-number">7.2.1</span> Markdown</h3>
<p>Ever heard of HTML? It’s what drives the internet. HTML is a <em>markup language</em> - that’s what the <em>ML</em> stands for. The terminology evolved from “marking up” paper manuscripts by editors, where the editor would instruct an author or typesetter how to render the resulting text. Markup languages let you annotate <strong>text</strong> that you want to display with instructions about how to display it.</p>
<p>I emphasize <strong>text</strong> because this is fundamentally different than word processing. When you use MS Word, for example, you’re creating a special proprietary binary file (the .docx) file that shows you how a document looks. By contrast, writing in a markup language like HTML or Markdown, you’re writing plain old text, using a text editor. The toolchain used to render the markup text into what you see on a display or in a PDF has always been and will always bee free and open.</p>
<p>You can learn Markdown in about 5 minutes. Let’s open up a web-based Markdown editor like <a href="http://dillinger.io/" class="uri">http://dillinger.io/</a> or use a desktop Markdown editor like <a href="http://markdownpad.com/">MarkdownPad</a> (Windows) or <a href="http://macdown.uranusjr.com/">MacDown</a> (Mac).</p>
</section><section id="rmarkdown-workflow" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="rmarkdown-workflow">
<span class="header-section-number">7.2.2</span> RMarkdown workflow</h3>
<p>RMarkdown is an enhanced version of Markdown that lets you embed R code into the document. When the document is compiled/rendered, the R code is executed by R, the output is then automatically rendered as Markdown with the rest of the document. The Markdown is then further processed to final output formats like HTML, PDF, DOCX, etc.</p>
<p><img src="img/rmarkdown-workflow.png" class="img-fluid"></p>
</section></section><section id="authoring-rmarkdown-documents" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="authoring-rmarkdown-documents">
<span class="header-section-number">7.3</span> Authoring RMarkdown documents</h2>
<blockquote class="blockquote">
<p><strong><em>Note</em></strong>: Before going any further, open up the options (Tools, Global Options), click the RMarkdown section, and <strong>uncheck</strong> the box, <em>“Show output inline for all R Markdown documents.”</em></p>
</blockquote>
<section id="from-scratch" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="from-scratch">
<span class="header-section-number">7.3.1</span> From scratch</h3>
<p>First, open RStudio. Create a new project. Quit RStudio, then launch RStudio using the project file (.Rproj) you just created.</p>
<p>Next, download the gapminder data from <a href="data.html">the data page</a>. Put this file in your R project directory. Maybe put it in a subdirectory called “data.” Importantly, now your code and data will live in the same place.</p>
<p>Let’s create a bare-bones RMarkdown document that compiles to HTML. In RStudio, select <strong>File</strong>, <strong>New File</strong>, <strong>R Markdown…</strong>. Don’t worry about the title and author fields. When the new document launches, select everything then delete it. Let’s author an RMarkdown file from scratch. Save it as <code>fromscratch.Rmd</code>.</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-2_2a0af10c537245be33ec0557887e6a9d">
<pre><code> # Introduction 
  
 This is my first RMarkdown document! 
  
 # Let's embed some R code 
  
 Let's load the **Gapminder** data: 
  

 ```{r} 
 library(dplyr) 
 library(readr) 
 gm &lt;- read_csv('data/gapminder.csv') 
 head(gm) 
 ``` 


 The mean life expectancy is `r mean(gm$lifeExp)` years. 
  
 The years surveyed in this data include: `r unique(gm$year)`. 
  
 # Session Information 
  

 ```{r} 
 sessionInfo() 
 ``` </code></pre>
</div>
<p>Hit the <strong>Knit HTML</strong> button in the editor window. You should see the rendered document pop up.</p>
<p>So let’s break that down to see exactly what happened there. Recall the RMarkdown Workflow shown above. You start with an RMarkdown document (Rmd). When you hit the Knit HTML button, The <strong>knitr</strong> R package parses through your source document and executes all the R code chunks defined by the R code chunk blocks. The source code itself and the results are then turned back into regular markdown, inserted into an intermediate markdown file (.md), and finally rendered into HTML by <a href="http://pandoc.org/">Pandoc</a>.</p>
<p>Try this. Instead of using the button, load the knitr package and just knit the document to markdown format. Run this in the console.</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-3_f975229ad383bc25c14e146437c64e30">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit.html">knit</a></span><span class="op">(</span><span class="st">"fromscratch.Rmd"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, open up that regular markdown file and take a look.</p>
<!-- indented code, what would be in markdown, starts here -->
<pre><code># Introduction

This is my first RMarkdown document!

# Let's embed some R code

Let's load the **Gapminder** data:


```r
library(dplyr)
library(readr)
gm &lt;- read_csv("data/gapminder.csv")
head(gm)
```

```
##       country continent year lifeExp      pop gdpPercap
## 1 Afghanistan      Asia 1952  28.801  8425333  779.4453
## 2 Afghanistan      Asia 1957  30.332  9240934  820.8530
## 3 Afghanistan      Asia 1962  31.997 10267083  853.1007
## 4 Afghanistan      Asia 1967  34.020 11537966  836.1971
## 5 Afghanistan      Asia 1972  36.088 13079460  739.9811
## 6 Afghanistan      Asia 1977  38.438 14880372  786.1134
```

The mean life expectancy is 59.4744394 years.

The years surveyed in this data include: 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2007.</code></pre>
<!-- end markdown -->
</section><section id="from-a-template-with-yaml-metadata" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="from-a-template-with-yaml-metadata">
<span class="header-section-number">7.3.2</span> From a template with YAML metadata</h3>
<p>Go ahead and start a new R Markdown document. Fill in some title and author information.</p>
<p>This is going to put a YAML header in the file that looks something like this:</p>
<pre><code>---
title: "Gapminder Analysis"
author: "Stephen Turner"
date: "January 1, 2017"
output: html_document
---</code></pre>
<p>The stuff between the three <code>---</code>s is metadata. You can read more about what kind of metadata can be included in the <a href="http://rmarkdown.rstudio.com/">RMarkdown documentation</a>. Try clicking the little wrench icon and setting some options, like including a table of contents and figure captions. Notice how the metadata front matter changes.</p>
<pre><code>---
title: "Gapminder analysis"
author: "Stephen Turner"
date: "January 1, 2017"
output: 
  html_document: 
    fig_caption: yes
    toc: yes
---</code></pre>
<p>Now, delete everything in that document below the metadata header and paste in what we had written before (above). Save this document under a different name (<code>rmdwithmeta.Rmd</code> for example). You’ll now see that your HTML document takes the metadata and makes a nicely formatted title.</p>
<p>Let’s add a plot in there. Open up a new R chunk with this:</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-4_1349682015b1d329709724de70245492">
<pre><code> ```{r, fig.cap='Life Exp vs GDP'} 
 library(ggplot2) 
 ggplot(gm, aes(gdpPercap, lifeExp)) + geom_point() 
 ``` </code></pre>
</div>
<p>Using RStudio you can fiddle around with different ways to make the graphic and keep the one you want. Maybe it looks like this:</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-5_8ce127f48b356e7836df84c4c0ff83f6">
<pre><code> ```{r, fig.cap='Life Exp vs GDP'} 
 library(ggplot2) 
 ggplot(gm, aes(gdpPercap, lifeExp)) +  
   geom_point() +  
   scale_x_log10() +  
   aes(col=continent) 
 ``` </code></pre>
</div>
</section><section id="chunk-options" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="chunk-options">
<span class="header-section-number">7.3.3</span> Chunk options</h3>
<p>You can modify the behavior of an R chunk with <a href="http://yihui.name/knitr/options/">options</a>. Options are passed in after a comma on the fence, as shown below.</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-6_c58eee46cb752b2f6fa443e8294794b0">
<pre><code> ```{r optionalChunkName, echo=TRUE, results='hide'} 
 # R code here 
 ``` </code></pre>
</div>
<p>Some commonly used options include:</p>
<ul>
<li>
<code>echo</code>: (<code>TRUE</code> by default) whether to include R source code in the output file.</li>
<li>
<code>results</code> takes several possible values:
<ul>
<li>
<code>markup</code> (the default) takes the result of the R evaluation and turns it into markdown that is rendered as usual.</li>
<li>
<code>hide</code> will hide results.</li>
<li>
<code>hold</code> will hold all the output pieces and push them to the end of a chunk. Useful if you’re running commands that result in lots of little pieces of output in the same chunk.</li>
<li>
<code>asis</code> writes the raw results from R directly into the document. Only really useful for tables.</li>
</ul>
</li>
<li>
<code>include</code>: (<code>TRUE</code> by default) if this is set to <code>FALSE</code> the R code is still evaluated, but neither the code nor the results are returned in the output document.</li>
<li>
<code>fig.width</code>, <code>fig.height</code>: used to control the size of graphics in the output.</li>
</ul>
<p>Try modifying your first R chunk to use different values for <code>echo</code>, <code>results</code>, and <code>include</code>.</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-7_0291361a2b56c0cdcd1024bcdb21c176">
<pre><code> ```{r} 
 gm &lt;- read.csv('data/gapminder.csv') 
 head(gm) 
 tail(gm) 
 ``` </code></pre>
</div>
<p>See the full list of options here: <a href="http://yihui.name/knitr/options/" class="uri">http://yihui.name/knitr/options/</a>. There are lots!</p>
<p>A special note about <strong>caching</strong>: The <code>cache=</code> option is automatically set to <code>FALSE</code>. That is, every time you render the Rmd, all the R code is run again from scratch. If you use <code>cache=TRUE</code>, for this chunk, knitr will save the results of the evaluation into a directory that you specify. When you re-render the document, knitr will first check if there are previously cached results under the cache directory before really evaluating the chunk; if cached results exist and this code chunk has not been changed since last run (use MD5 sum to verify), the cached results will be (lazy-) loaded, otherwise new cache will be built; if a cached chunk depends on other chunks (see the <code>dependson</code> option) and any one of these chunks has changed, this chunk must be forcibly updated (old cache will be purged). <strong>See <a href="http://yihui.name/knitr/demo/cache/">the documentation for caching</a>.</strong></p>
</section><section id="tables" class="level3" data-number="7.3.4"><h3 data-number="7.3.4" class="anchored" data-anchor-id="tables">
<span class="header-section-number">7.3.4</span> Tables</h3>
<p>The <a href="http://yihui.name/knitr/">knitr</a> package that runs the RMarkdown document in the background also has a function called <code>kable</code> that helps with printing tables nicely. It’s only useful when you set <code>echo=FALSE</code> and <code>results='asis'</code>. Try this.</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-8_daf151cf1a64bc1bf8bbfcaa112f3c3c">
<pre><code> ```{r} 
 head(gm) 
 ``` </code></pre>
</div>
<p>Versus this:</p>
<div class="cell" data-hash="rmarkdown_cache/html/unnamed-chunk-9_692d861fe2abd72346575a0f951a61a0">
<pre><code> ```{r, results='asis'} 
 library(knitr) 
 kable(head(gm)) 
 ``` </code></pre>
</div>
</section><section id="changing-output-formats" class="level3" data-number="7.3.5"><h3 data-number="7.3.5" class="anchored" data-anchor-id="changing-output-formats">
<span class="header-section-number">7.3.5</span> Changing output formats</h3>
<p>Now try this. If you were successfully able to get a LaTeX distribution installed, you can render this document as a PDF instead of HTML. Try changing the line in the metadata from <code>html_document</code> to <code>pdf_document</code>. Notice how the <em>Knit HTML</em> button in RStudio now changes to <em>Knit PDF</em>. Try it. If you didn’t get a LaTeX engine installed this won’t work. Go back to the setup instructions after class to give this a try.</p>
</section></section><section id="distributing-analyses-rpubs" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="distributing-analyses-rpubs">
<span class="header-section-number">7.4</span> Distributing Analyses: Rpubs</h2>
<p><a href="http://rpubs.com/">RPubs.com</a> is a free service from RStudio that allows you to seamlessly publish the results of your R analyses online. Sign up for an account at <a href="http://rpubs.com/">RPubs.com</a>, then sign in on your browser.</p>
<p>Make sure your RMarkdown metadata is set to render to HTML rather than PDF. Render the document. Now notice the little <strong>Publish</strong> button in the HTML viewer pane. Click this. Sign in when asked, and give your document a name (usually the same name as the title of your Rmd).</p>
<p>Here are a few examples of documents I’ve published:</p>
<ul>
<li>
<a href="http://rpubs.com/turnersd/daily_show_guests" class="uri">http://rpubs.com/turnersd/daily_show_guests</a>: Analysis of every guest who’s ever been on <em>The Daily Show with Jon Stewart</em>.</li>
<li>
<a href="http://rpubs.com/turnersd/twoaxes" class="uri">http://rpubs.com/turnersd/twoaxes</a>: How to plot two different tracks of data with one axis on the left and one axis on the right.</li>
<li>
<a href="http://rpubs.com/turnersd/anscombe" class="uri">http://rpubs.com/turnersd/anscombe</a>: Analysis of <em>Anscombe’s Quartet</em> data.</li>
</ul>
<p><strong>Note how RPubs doesn’t share your code!</strong> RPubs is a great way to share your analysis but doesn’t let you share the source code. This is a huge barrier to reproducibility. There are plenty of ways to do this. One way is to go to <a href="https://gist.github.com">gist.github.com</a> and upload your code as a text file, then link back to the gist in your republished RPubs document.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Freedman, et al.&nbsp;“The economics of reproducibility in preclinical research.” <em>PLoS Biol</em> 13.6 (2015): e1002165.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="http://www.nature.com/news/first-results-from-psychology-s-largest-reproducibility-test-1.17433" class="uri">http://www.nature.com/news/first-results-from-psychology-s-largest-reproducibility-test-1.17433</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="http://www.nature.com/news/reproducibility-1.17552" class="uri">http://www.nature.com/news/reproducibility-1.17552</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Ioannidis, John PA, et al.&nbsp;“Repeatability of published microarray gene expression analyses.” <em>Nature genetics</em> 41.2 (2009): 149-155.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Nekrutenko, Anton, and James Taylor. “Next-generation sequencing data interpretation: enhancing reproducibility and accessibility.” <em>Nature Reviews Genetics</em> 13.9 (2012): 667-672.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><a href="http://adv-r.had.co.nz/Style.html" class="uri">http://adv-r.had.co.nz/Style.html</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./tidyeda.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Refresher: Tidy Exploratory Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./stats.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Essential statistics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© 2019 Stephen D. Turner, Ph.D.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://x.com/strnr">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/stephenturner">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/turnersd/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://stephenturner.us/">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://blog.stephenturner.us/">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>